<div>
  <div class="flex flex-col items-start pl-7 pr-6 details">
    <button (click)="closeViewDetails()">
      <div class="backBtn flex items-center justify-center">
        <mat-icon class="material-icons-round arrowBack">arrow_back</mat-icon>
      </div>
    </button>
    <div class="flex" *ngIf="!isLoading">
      <div class="flex flex-col">
        <div class="flex justify-between">
          <span class="routeName text-dark font-extrabold uppercase mb-3">
            Route {{ routeDetails.task.name }}
          </span>
        </div>

        <div class="flex flex-row">
          <div class="flex">
            <div class="flex flex-row w-full routeDetailsContainer gap-3 mb-6">
              <p class="flex text-sm driverName routeDetailsRow text-light capitalize">
                <mat-icon class="text-dark mr-2">person_outline</mat-icon>
                {{
                  (routeDetails.task.driver | driverFullName).length > 22
                    ? (routeDetails.task.driver | driverFullName).slice(0, 23) +
                      "... \n" +
                      routeDetails.task.driver?.id
                    : ((routeDetails.task.driver | driverFullName) + routeDetails.task.driver?.id)
                        .length > 22
                    ? (routeDetails.task.driver | driverFullName) +
                      "\n" +
                      routeDetails.task.driver?.id
                    : (routeDetails.task.driver | driverFullName) +
                      " " +
                      routeDetails.task.driver?.id
                }}
              </p>
              <span class="flex text-sm routeDetailsRow text-light capitalize">
                <svg
                  class="text-dark mr-2"
                  width="21"
                  height="20"
                  viewBox="0 0 21 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg">
                  <rect x="6.74646" y="11.6667" width="6.66667" height="3.33333" fill="#212121" />
                  <rect x="7.57977" y="4.16675" width="5" height="1.66667" fill="#212121" />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M7.74646 2.91675H12.4131C14.5888 2.91675 16.4228 4.37943 16.9854 6.37508L3.17419 6.37508C3.73684 4.37943 5.57083 2.91675 7.74646 2.91675ZM2.99669 7.61961L2.99646 7.66675V9.5834L17.1631 9.58341V7.66675L17.1629 7.61959C17.1357 7.62321 17.1079 7.62508 17.0797 7.62508L3.07971 7.62508C3.05156 7.62508 3.02385 7.62321 2.99669 7.61961ZM18.4131 9.58341V7.66675C18.4131 4.35304 15.7268 1.66675 12.4131 1.66675H7.74646C4.43275 1.66675 1.74646 4.35304 1.74646 7.66675V9.5834V10.8334V14.6667C1.74646 15.6641 2.47645 16.4909 3.43126 16.6421C3.41925 16.704 3.41296 16.768 3.41296 16.8334V17.3334C3.41296 17.8857 3.86068 18.3334 4.41296 18.3334H6.57963C7.13192 18.3334 7.57963 17.8857 7.57963 17.3334V16.8334C7.57963 16.7766 7.5749 16.7209 7.56581 16.6667H12.5935C12.5844 16.7209 12.5797 16.7766 12.5797 16.8334V17.3334C12.5797 17.8857 13.0274 18.3334 13.5797 18.3334H15.7464C16.2987 18.3334 16.7464 17.8857 16.7464 17.3334V16.8334C16.7464 16.768 16.7401 16.704 16.7281 16.6421C17.683 16.491 18.4131 15.6642 18.4131 14.6667V10.8334V9.58341ZM17.1631 10.8334L2.99646 10.8334V14.6667C2.99646 15.081 3.33225 15.4167 3.74646 15.4167H16.4131C16.8273 15.4167 17.1631 15.081 17.1631 14.6667V10.8334Z"
                    fill="#212121" />
                  <circle cx="5.07979" cy="14.1666" r="0.833333" fill="#212121" />
                  <circle cx="15.0798" cy="14.1666" r="0.833333" fill="#212121" />
                  <circle cx="14.2464" cy="5.00008" r="0.833333" fill="#212121" />
                  <circle cx="5.91311" cy="5.00008" r="0.833333" fill="#212121" />
                </svg>
                <p class="vehicleId">
                  {{ routeDetails.fleetNumber ? routeDetails.fleetNumber : "Unassigned" }}
                </p>
              </span>

              <span
                *ngIf="!busNotAvailable"
                class="flex text-sm routeDetailsRow text-light capitalize">
                <svg
                  class="text-dark mr-2"
                  width="20"
                  height="20"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg">
                  <mask
                    id="mask0_508_1232"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="20"
                    height="20">
                    <rect width="20" height="20" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_508_1232)">
                    <path
                      d="M10 19.125C9.764 19.125 9.559 19.0383 9.385 18.865C9.21167 18.691 9.125 18.486 9.125 18.25V17.438C7.43033 17.2433 5.96167 16.5243 4.719 15.281C3.47567 14.0383 2.75667 12.5697 2.562 10.875H1.75C1.514 10.875 1.309 10.7883 1.135 10.615C0.961667 10.441 0.875 10.236 0.875 10C0.875 9.764 0.961667 9.559 1.135 9.385C1.309 9.21167 1.514 9.125 1.75 9.125H2.562C2.75667 7.43033 3.47567 5.96167 4.719 4.719C5.96167 3.47567 7.43033 2.75667 9.125 2.562V1.75C9.125 1.514 9.21167 1.309 9.385 1.135C9.559 0.961667 9.764 0.875 10 0.875C10.236 0.875 10.441 0.961667 10.615 1.135C10.7883 1.309 10.875 1.514 10.875 1.75V2.562C12.5697 2.75667 14.0383 3.47567 15.281 4.719C16.5243 5.96167 17.2433 7.43033 17.438 9.125H18.25C18.486 9.125 18.691 9.21167 18.865 9.385C19.0383 9.559 19.125 9.764 19.125 10C19.125 10.236 19.0383 10.441 18.865 10.615C18.691 10.7883 18.486 10.875 18.25 10.875H17.438C17.2433 12.5697 16.5243 14.0383 15.281 15.281C14.0383 16.5243 12.5697 17.2433 10.875 17.438V18.25C10.875 18.486 10.7883 18.691 10.615 18.865C10.441 19.0383 10.236 19.125 10 19.125ZM10 15.729C11.5973 15.729 12.9513 15.1733 14.062 14.062C15.1733 12.9513 15.729 11.5973 15.729 10C15.729 8.40267 15.1733 7.04867 14.062 5.938C12.9513 4.82667 11.5973 4.271 10 4.271C8.40267 4.271 7.04867 4.82667 5.938 5.938C4.82667 7.04867 4.271 8.40267 4.271 10C4.271 11.5973 4.82667 12.9513 5.938 14.062C7.04867 15.1733 8.40267 15.729 10 15.729ZM10 13.396C9.06933 13.396 8.27067 13.0627 7.604 12.396C6.93733 11.7293 6.604 10.9307 6.604 10C6.604 9.06933 6.93733 8.27067 7.604 7.604C8.27067 6.93733 9.06933 6.604 10 6.604C10.9307 6.604 11.7293 6.93733 12.396 7.604C13.0627 8.27067 13.396 9.06933 13.396 10C13.396 10.9307 13.0627 11.7293 12.396 12.396C11.7293 13.0627 10.9307 13.396 10 13.396ZM10 11.646C10.4447 11.646 10.83 11.4827 11.156 11.156C11.4827 10.83 11.646 10.4447 11.646 10C11.646 9.55533 11.4827 9.17 11.156 8.844C10.83 8.51733 10.4447 8.354 10 8.354C9.55533 8.354 9.17 8.51733 8.844 8.844C8.51733 9.17 8.354 9.55533 8.354 10C8.354 10.4447 8.51733 10.83 8.844 11.156C9.17 11.4827 9.55533 11.646 10 11.646Z"
                      fill="#212121" />
                  </g>
                </svg>
                {{ routeDetails.heading | direction }}, {{ routeDetails.speed }}
                {{ routeDetails.speedUnit }}</span
              >
              <span
                *ngIf="busNotAvailable"
                class="flex text-sm routeDetailsRow text-light capitalize">
                <svg
                  class="mr-2"
                  width="20"
                  height="20"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg">
                  <mask
                    id="mask0_584_615"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="20"
                    height="20">
                    <rect width="20" height="20" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_584_615)">
                    <path
                      d="M16.375 13.896L15.104 12.625C15.2987 12.2363 15.4513 11.823 15.562 11.385C15.6733 10.9477 15.729 10.486 15.729 10C15.729 8.40267 15.1733 7.04867 14.062 5.938C12.9513 4.82667 11.5973 4.271 10 4.271C9.5 4.271 9.03467 4.32667 8.604 4.438C8.17333 4.54867 7.76367 4.70133 7.375 4.896L6.104 3.625C6.56267 3.347 7.03833 3.118 7.531 2.938C8.02433 2.75733 8.55567 2.632 9.125 2.562V1.75C9.125 1.514 9.21167 1.309 9.385 1.135C9.559 0.961667 9.764 0.875 10 0.875C10.236 0.875 10.441 0.961667 10.615 1.135C10.7883 1.309 10.875 1.514 10.875 1.75V2.562C12.5697 2.75667 14.0383 3.47567 15.281 4.719C16.5243 5.96167 17.2433 7.43033 17.438 9.125H18.25C18.486 9.125 18.691 9.21167 18.865 9.385C19.0383 9.559 19.125 9.764 19.125 10C19.125 10.236 19.0383 10.441 18.865 10.615C18.691 10.7883 18.486 10.875 18.25 10.875H17.438C17.382 11.4303 17.2603 11.965 17.073 12.479C16.8857 12.993 16.653 13.4653 16.375 13.896ZM10 19.125C9.764 19.125 9.559 19.0383 9.385 18.865C9.21167 18.691 9.125 18.486 9.125 18.25V17.438C7.43033 17.2433 5.96167 16.5243 4.719 15.281C3.47567 14.0383 2.75667 12.5697 2.562 10.875H1.75C1.514 10.875 1.309 10.7883 1.135 10.615C0.961667 10.441 0.875 10.236 0.875 10C0.875 9.764 0.961667 9.559 1.135 9.385C1.309 9.21167 1.514 9.125 1.75 9.125H2.562C2.632 8.56967 2.75733 8.03833 2.938 7.531C3.118 7.02433 3.347 6.53467 3.625 6.062L1.75 4.188C1.58333 4.02133 1.50333 3.81633 1.51 3.573C1.51733 3.32967 1.60433 3.12467 1.771 2.958C1.93767 2.79133 2.14233 2.708 2.385 2.708C2.62833 2.708 2.83333 2.79133 3 2.958L17.042 17.021C17.2087 17.1877 17.292 17.389 17.292 17.625C17.292 17.861 17.2087 18.0623 17.042 18.229C16.8753 18.3957 16.6703 18.479 16.427 18.479C16.1837 18.479 15.9787 18.3957 15.812 18.229L13.917 16.354C13.4443 16.646 12.9547 16.882 12.448 17.062C11.9413 17.2427 11.417 17.368 10.875 17.438V18.25C10.875 18.486 10.7883 18.691 10.615 18.865C10.441 19.0383 10.236 19.125 10 19.125ZM10 15.729C10.4587 15.729 10.91 15.677 11.354 15.573C11.7987 15.469 12.2223 15.3057 12.625 15.083L4.917 7.375C4.69433 7.77767 4.531 8.19433 4.427 8.625C4.323 9.05567 4.271 9.514 4.271 10C4.271 11.5973 4.82667 12.9513 5.938 14.062C7.04867 15.1733 8.40267 15.729 10 15.729Z"
                      fill="#DA291C" />
                  </g>
                </svg>
                <span class="text-xs text-red-500 lastConnected font-semibold">{{
                  "Last connected \n" + (routeDetails.eventEndTime | formatTime : "short")
                }}</span>
              </span>
            </div>
          </div>
          <!-- <button
            type="button"
            class="button-outline mt-6 mb-6 w-fit"
            id="nearbyBtn"
            (click)="toggleNearbyBuses()">
            <svg
              class="mr-2"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <mask
                id="mask0_275_139"
                style="mask-type: alpha"
                maskUnits="userSpaceOnUse"
                x="0"
                y="0"
                width="24"
                height="24">
                <rect width="24" height="24" fill="#007ac9" />
              </mask>
              <g mask="url(#mask0_275_139)">
                <path
                  d="M12 22C10.6167 22 9.31667 21.7373 8.1 21.212C6.88333 20.6873 5.825 19.975 4.925 19.075C4.025 18.175 3.31267 17.1167 2.788 15.9C2.26267 14.6833 2 13.3833 2 12C2 10.6167 2.26267 9.31667 2.788 8.1C3.31267 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.31233 8.1 2.787C9.31667 2.26233 10.6167 2 12 2C13.3833 2 14.6833 2.26233 15.9 2.787C17.1167 3.31233 18.175 4.025 19.075 4.925C19.975 5.825 20.6873 6.88333 21.212 8.1C21.7373 9.31667 22 10.6167 22 12C22 13.3833 21.7373 14.6833 21.212 15.9C20.6873 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6873 15.9 21.212C14.6833 21.7373 13.3833 22 12 22ZM12 20C12.9333 20 13.8123 19.854 14.637 19.562C15.4623 19.2707 16.2167 18.8583 16.9 18.325L15.475 16.9C14.9917 17.25 14.4543 17.5207 13.863 17.712C13.271 17.904 12.65 18 12 18C10.3333 18 8.91667 17.4167 7.75 16.25C6.58333 15.0833 6 13.6667 6 12C6 10.3333 6.58333 8.91667 7.75 7.75C8.91667 6.58333 10.3333 6 12 6C13.6667 6 15.0833 6.58333 16.25 7.75C17.4167 8.91667 18 10.3333 18 12C18 12.65 17.9 13.275 17.7 13.875C17.5 14.475 17.225 15.0167 16.875 15.5L18.3 16.925C18.8333 16.2417 19.25 15.4833 19.55 14.65C19.85 13.8167 20 12.9333 20 12C20 9.76667 19.225 7.875 17.675 6.325C16.125 4.775 14.2333 4 12 4C9.76667 4 7.875 4.775 6.325 6.325C4.775 7.875 4 9.76667 4 12C4 14.2333 4.775 16.125 6.325 17.675C7.875 19.225 9.76667 20 12 20ZM12 16C12.3667 16 12.7207 15.9543 13.062 15.863C13.404 15.771 13.725 15.6333 14.025 15.45L12.5 13.925C12.4167 13.9583 12.3333 13.9793 12.25 13.988C12.1667 13.996 12.0833 14 12 14C11.45 14 10.9793 13.804 10.588 13.412C10.196 13.0207 10 12.55 10 12C10 11.45 10.196 10.979 10.588 10.587C10.9793 10.1957 11.45 10 12 10C12.55 10 13.021 10.1957 13.413 10.587C13.8043 10.979 14 11.45 14 12C14 12.1 13.996 12.1957 13.988 12.287C13.9793 12.379 13.9583 12.4667 13.925 12.55L15.425 14.05C15.6083 13.75 15.75 13.429 15.85 13.087C15.95 12.7457 16 12.3833 16 12C16 10.9 15.6083 9.95833 14.825 9.175C14.0417 8.39167 13.1 8 12 8C10.9 8 9.95833 8.39167 9.175 9.175C8.39167 9.95833 8 10.9 8 12C8 13.1 8.39167 14.0417 9.175 14.825C9.95833 15.6083 10.9 16 12 16Z"
                  fill="#007ac9" />
              </g>
            </svg>

            Nearby Buses
          </button> -->
        </div>
      </div>
    </div>
    <mat-progress-bar class="mt-4" *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>
  </div>
  <app-timeline></app-timeline>
  <div *ngIf="isNearbyBuses" class="flex flex-col">
    <div class="flex flex-col items-start pl-7 pr-6">
      <h3 class="uppercase text-light">Nearby buses</h3>
      <div class="flex flex-row justify-between w-full">
        <span class="text-sm text-light">5 Buses </span>
        <mat-icon class="cursor-pointer material-icons-outlined" id="closeNearby">close</mat-icon>
      </div>
    </div>
    <div class="line mt-3.5"></div>
    <div class="flex flex-row justify-between pl-7 pr-6">
      <mat-select value="All Buses" class="busTypes mb-3.5 mt-2">
        <mat-option value="All Buses"> All Buses </mat-option>
      </mat-select>
      <div class="flex pt-[10px] pb-[8px] text-sm justify-between items-center w-1/3">
        <span class="text-sm mr-1">Sort: </span>
        <mat-form-field
          appearance="fill"
          class="flex justify-start items-center w-11/12"
          id="sortDropdown">
          <mat-select value="Name (A-Z)" id="sortSelect">
            <mat-option value="Name (A-Z)" class="text-secondary-blue matSortOption">
              Name (A-Z)
            </mat-option>
            <mat-option value="Name (Z-A)" class="text-secondary-blue matSortOption">
              Name (Z-A)
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="flex flex-col overflow-auto resultsContainer" *ngIf="nearbyBuses.length > 0">
      <div class="bottomShadow"></div>
      <div class="flex flex-col" *ngFor="let bus of nearbyBuses">
        <app-bus-details
          [bus]="bus"
          [clicked]="isResultSelected(bus.vehicle.properties.id)"></app-bus-details>
      </div>
    </div>
  </div>
</div>
